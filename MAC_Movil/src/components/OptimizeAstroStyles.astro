---
// OptimizeAstroStyles.astro - Componente para optimizar los estilos generados por Astro
---

<script is:inline>
  /**
   * Script para eliminar CSS bloqueantes generados por Astro y cargarlos de forma asíncrona
   * Esto es un respaldo en caso de que inlineStylesheets: 'always' en astro.config.mjs no funcione completamente
   */
  (function() {
    // Run immediately, not waiting for DOMContentLoaded
    // Seleccionar todos los estilos Astro bloqueantes
    const astroStyles = document.querySelectorAll(
      'link[rel="stylesheet"][href*="_astro/"]'
    );

    if (astroStyles.length > 0) {
      // Convertir a un array para manipulación
      Array.from(astroStyles).forEach((style) => {
        const href = style.getAttribute("href");

        // 1. Crear un nuevo elemento link que cargue de forma no bloqueante
        const nonBlockingStyle = document.createElement("link");
        nonBlockingStyle.rel = "stylesheet";
        nonBlockingStyle.href = href;
        nonBlockingStyle.media = "print"; // Inicialmente no bloquea
        nonBlockingStyle.onload = () => {
          // Cambiar a 'all' después de cargarse
          nonBlockingStyle.media = "all";
        };

        // 2. Remover el estilo bloqueante original
        if (style.parentNode) {
          style.parentNode.removeChild(style);
        }

        // 3. Añadir el nuevo estilo no bloqueante
        document.head.appendChild(nonBlockingStyle);

        console.log("Optimized Astro style:", href);
      });
    }
  })();
</script>
